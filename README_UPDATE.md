# 项目管理系统更新说明

## 更新内容

### 1. 项目状态更新
- **原状态**: 立项、开发、结项、跟进收款、维护
- **新状态**: 启动中、进行中、暂停、验收中、验收待回款、关闭

### 2. 新增项目字段
- **客户名称**: 记录项目客户信息
- **项目类型**: 物流仿真、机器人仿真、工艺规划、物流规划、动画、激光扫描、数字孪生
- **付款方式**: 验收后全款、分阶段、预付初版、预付终版、待填写
- **验收日期**: 项目验收完成日期
- **发票是否开具**: 布尔字段，标记发票状态
- **合同金额含税**: 替代原来的合同金额字段
- **合同金额不含税**: 新增字段
- **回款金额**: 已收到的付款金额
- **剩余金额**: 自动计算的未收款金额

### 3. 界面更新
- 项目创建和编辑表单新增所有字段
- 项目详情页面重新布局，分为基本信息和财务信息两个部分
- 项目列表页面新增客户名称和项目类型列

## 数据库迁移

### 方式一：全新安装（推荐用于测试）
直接运行 `python app.py`，系统会自动创建新的数据库结构。

### 方式二：保留现有数据迁移
如果你有现有数据需要保留，请按以下步骤操作：

1. **备份现有数据**（重要！）
   ```bash
   cp instance/projects.db instance/projects_backup.db
   ```

2. **运行迁移脚本**
   ```bash
   python migrate_database.py
   ```

3. **启动应用**
   ```bash
   python app.py
   ```

## 运行步骤

1. **确保环境**
   ```bash
   # 激活虚拟环境（如果使用）
   project_mgmt_env\Scripts\activate  # Windows
   # 或
   source project_mgmt_env/bin/activate  # Linux/Mac
   ```

2. **安装依赖**（如果还没安装）
   ```bash
   pip install -r requirements.txt
   ```

3. **数据库处理**
   - 新系统：直接跳到步骤4
   - 现有系统：运行 `python migrate_database.py`

4. **启动应用**
   ```bash
   python app.py
   ```

5. **访问系统**
   - 地址：http://localhost:5000
   - 管理员账号：admin / admin123
   - 开发者账号：developer / dev123

## 注意事项

1. **数据兼容性**: 旧的项目状态会自动映射到新状态
2. **合同金额**: 原有的 `contract_amount` 会迁移到 `contract_amount_with_tax`
3. **剩余金额**: 系统会自动计算 (含税金额 - 回款金额)
4. **新字段默认值**: 新增字段在现有项目中可能显示为"未设置"，可通过编辑项目来填充

## 功能增强

- 项目列表现在显示更多信息，包括客户和项目类型
- 项目详情页面提供更完整的财务信息视图
- 新的状态系统更好地反映项目的实际进展
- 支持更详细的付款跟踪和发票管理

## 问题排查

如果遇到问题：
1. 检查数据库文件是否存在：`instance/projects.db`
2. 查看控制台输出的错误信息
3. 确认所有新字段都正确添加到数据库
4. 必要时可以删除 `instance/projects.db` 重新开始