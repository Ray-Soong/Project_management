{% extends "base.html" %}

{% block title %}工时记录 - 项目管理系统{% endblock %}

{% block content %}
<h1 class="page-title">
    {% if current_user.is_admin() %}
        工时记录管理
    {% else %}
        我的工时记录
    {% endif %}
</h1>

<!-- 查询过滤器 -->
<div class="card" style="margin-bottom: 2rem;">
    <form method="GET" action="{{ url_for('worklog_list') }}" style="display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap;">
        {% if current_user.is_admin() %}
        <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
            <label class="form-label" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">
                <i class="fas fa-user" style="color: #667eea; margin-right: 0.3rem;"></i>
                开发人员
            </label>
            <select name="user_id" class="form-control" style="width: 100%;">
                <option value="">全部人员</option>
                {% for user in users %}
                    <option value="{{ user.id }}" {% if selected_user_id == user.id %}selected{% endif %}>
                        {{ user.username }}
                    </option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        
        <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
            <label class="form-label" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">
                <i class="fas fa-project-diagram" style="color: #667eea; margin-right: 0.3rem;"></i>
                项目
            </label>
            <select name="project_id" class="form-control" style="width: 100%;">
                <option value="">全部项目</option>
                {% for project in projects %}
                    <option value="{{ project.id }}" {% if selected_project_id == project.id %}selected{% endif %}>
                        {{ project.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        
        <div style="display: flex; gap: 0.5rem;">
            <button type="submit" class="btn btn-primary" style="white-space: nowrap;">
                <i class="fas fa-search"></i> 查询
            </button>
            <a href="{{ url_for('worklog_list') }}" class="btn btn-secondary" style="white-space: nowrap;">
                <i class="fas fa-redo"></i> 重置
            </a>
        </div>
    </form>
</div>

<!-- 工时记录列表 -->
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="margin: 0; color: #333;">
            工时记录
            <span style="color: #666; font-size: 0.9rem; font-weight: normal; margin-left: 1rem;">
                (共 {{ worklogs|length }} 条记录，总工时 {{ "%.1f"|format(worklogs|sum(attribute='hours') or 0) }} 小时)
            </span>
        </h2>
        {% if current_user.is_developer() %}
            <a href="{{ url_for('create_worklog') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> 记录工时
            </a>
        {% endif %}
    </div>
    
    {% if worklogs %}
    <div class="table-container">
        <table class="project-table">
            <thead>
                <tr>
                    <th>记录ID</th>
                    {% if current_user.is_admin() %}
                        <th>开发者</th>
                    {% endif %}
                    <th>项目名称</th>
                    <th>工作日期</th>
                    <th>工作时长</th>
                    <th>工作描述</th>
                    <th>记录时间</th>
                </tr>
            </thead>
            <tbody>
                {% for log in worklogs %}
                <tr>
                    <td><strong>#{{ log.id }}</strong></td>
                    {% if current_user.is_admin() %}
                        <td>
                            <span class="badge" style="background: #667eea; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">
                                {{ log.user.username }}
                            </span>
                        </td>
                    {% endif %}
                    <td>{{ log.project.name }}</td>
                    <td>{{ log.date.strftime('%Y-%m-%d') }}</td>
                    <td><strong style="color: #007bff;">{{ log.hours }}小时</strong></td>
                    <td style="max-width: 300px;">
                        {% if log.description %}
                            <div style="white-space: pre-wrap; word-break: break-word;">
                                {{ log.description[:100] }}
                                {% if log.description|length > 100 %}...{% endif %}
                            </div>
                        {% else %}
                            <span style="color: #999;">无描述</span>
                        {% endif %}
                    </td>
                    <td>{{ log.created_at.strftime('%m-%d %H:%M') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-clock" style="font-size: 4rem; color: #ddd; margin-bottom: 1rem;"></i>
        <h3>暂无工时记录</h3>
        {% if current_user.is_developer() %}
            <p>还没有记录任何工时，点击上方按钮开始记录工时吧！</p>
            <a href="{{ url_for('create_worklog') }}" class="btn btn-primary" style="margin-top: 1rem;">
                <i class="fas fa-plus"></i> 记录第一个工时
            </a>
        {% else %}
            <p>没有找到符合条件的工时记录，请调整查询条件</p>
        {% endif %}
    </div>
    {% endif %}
</div>

<style>
.form-group {
    margin-bottom: 1rem;
}

.form-label {
    font-weight: 600;
    color: #333;
    margin-bottom: 0.5rem;
}

.form-control {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid #ced4da;
    border-radius: 4px;
    font-size: 0.9rem;
}

.form-control:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 4px;
    font-size: 0.9rem;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s;
}

.btn-primary {
    background: #667eea;
    color: white;
}

.btn-primary:hover {
    background: #5568d3;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
}

.badge {
    display: inline-block;
    white-space: nowrap;
}

.empty-state {
    text-align: center;
    padding: 3rem;
    color: #666;
}

.table-container {
    overflow-x: auto;
}

@media (max-width: 768px) {
    .form-group {
        min-width: 100% !important;
    }
    
    .project-table th,
    .project-table td {
        font-size: 0.8rem;
        padding: 0.5rem;
    }
}
</style>
{% endblock %}